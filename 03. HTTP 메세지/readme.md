# 3. HTTP 메시지

## 3.1 메시지의 흐름
- HTTP 어플리케이션 간 주고받는 HTTP 메세지는 데이터 덩어리이다.

- ### 3.1.1 인바운드 / 아웃바운드
  - 트랜잭션 방향을 표현할 때 인바운드 / 아웃바운드 라는 용어를 활용한다.
  
![image](https://user-images.githubusercontent.com/87873821/220694731-d25a8c16-8f27-4fd6-a263-30a9197f3c99.png)

- ### 3.1.2 업스트림 / 다운스트림
  - HTTP 메시지는 무조건 발송자가 **업스트림**, 수신자가 **다운스트림**이다.
  - HTTP 메시지는 무조건 업스트림 에서 다운스트림 으로 흐른다.
  
![image](https://user-images.githubusercontent.com/87873821/220697152-f0a8f3be-1b6b-4717-8f2d-ff880dd80ca9.png)

## 3.2 메시지의 각 부분
- HTTP 메시지는 단순한 데이터의 블록이며 요청 혹은 응답 둘 중 하나이다.
- 메시지는 시작줄, 헤더 블록, 본문 세 요소로 이루어진다.
  - **시작줄** : 어떤 메시지 인지 서술
  - **헤더 블록** : 메시지의 속성
  - **본문** : 메시지의 데이터. 없을 수도 있다.

- ### 3.2.1 메시지 문법
  - **요청 메시지 형식**
    ```
    <메서드> <요청 URL> <버전> - 시작줄
    <해더> - 헤더블록

    <엔티티 본문> - 본문
    ```
  - **응답 메시지 형식**
    ```
    <버전> <상태 코드> <사유 구절> - 시작줄
    <해더> - 헤더블록

    <엔티티 본문> - 본문
    ```
- ### 3.2.2 시작줄  
  - **메서드** : 클라이언트가 서버에게 해당 리소스에 대해 수행해주길 바라는 동작
  - **요청 URL** : 요청 대상 리소스를 지칭하는 URL
  - **버전** : HTTP 메시지에서 사용중인 HTTP 버전
  - **상태코드** : 요청 처리중 어떤 일(성공, 실패 등)이 발생했는지 나타냄
  - **사유 구절** : 상태 코드를 사람이 쉽게 이해하기 위해 존재. 상태코드 이후, 줄바꿈 이전까지가 사유 구절
  - **헤더** : 0개 이상 존재, 헤더 목록은 빈 줄로 끝나 헤더 목록의 끝과 엔티티 본문의 시작을 표시한다.
  - **엔티티 본문** : 임의의 데이터 블록을 포함한다. 엔티티 본문이 없어도 HTTP 헤더는 항상 빈 줄로 끝난다.
  - **응답줄** : 수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려준다.
  - **메서드** : 요청 시작줄은 메서드로 시작하며 메서드는 서버에게 어떤 동작을 요청하는지 말해준다.
  - **상태코드** : 상태코드는 클라이언트에게 요청 후 결과를 말해주며, 응답 메세지의 시작줄에 담간다.
  - **사유구절** : 응답 시작줄의 마지막 요소이며, 상태 코드를 간단하게 설명한다.
  - **버전번호** : 요청, 응답 메세지 양쪽에 기술하며, HTTP 어플리케이션이 자신이 사용하는 HTTP 버전을 보여준다.

- ### 3.2.3 헤더
  -  HTTP 헤더 필드는 요청과 응답 메세지에 추가 정보를 더한다. 기본적으로 이름/값 한 쌍으로 이루어져 있다. 
  - **헤더 분류**
    - **일반 헤더** : 요청과 응답 양쪽에 모두 나타남
    - **요청 헤더** : 요청에 대한 부가 정보 제공
    - **응답 헤더** : 응답에 대한 부가 정보 제공
    - **Entity 헤더** : 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술
    - **확장 헤더** : 명세에 정의되지 않은 새로운 헤더
- ### 3.2.4 엔티티 본문
  - 엔티티 본문은 여러 종류의 디지털 데이터를 전달할 수 있다.
  - HTTP 0.9 버전에서는 요청 메세지는 단순히 메서드와 URL, 응답 메세지는 엔티티 본문 으로만 이루어져 있었다.
## 3.3 메서드
- ### 3.3.1 안전한 메서드 (Safe Method)
  - HTTP는 안전한 메서드라 불리는 메서드의 집합을 정의한다. 이는 GET, HEAD 메서드를 요청시 서버에 어떤 작용도 없음을 의미한다.
  - 안전한 메서드가 서버에 아무 영향을 주지 않는다는 보장은 할 수 없지만, 안전한 메서드의 목적은 서버에 안좋은 영향을 미칠 수 있는 메서드가 사용될 때
  이를 경고할 수 있는 HTTP 어플리케이션을 만들 수 있도록 하는것에 있다.
- ### 3.3.2 **GET**
  - 서버에게 리소스를 요청할때 사용하는 메서드

![image](https://user-images.githubusercontent.com/87873821/221024853-824b4464-5ed5-491a-bcf8-dd12e1805296.png)

- ### 3.3.3 **HEAD**
  - GET과 똑같이 동작하지만, 서버는 응답 메세지에 헤더만 돌려준다. 이는 다음과 같은 이점이 있다
    1. 리소스를 가져오지 않고도 타입 등을 알 수 있다.
    2. 응답의 상태코드를 통해 리소스가 존재하는지 확인할 수 있다.
    3. 헤더를 확인하여 리소스가 변경되었는지 검사할 수 있다.

![image](https://user-images.githubusercontent.com/87873821/221026047-32152856-d8c8-43ac-a5fd-998f3d3806fb.png)
  
- ### 3.3.4 **PUT**
  - 서버에 문서를 작성하는 메서드.
  - 서버가 요청 메시지의 본문을 가지고 URL의 이름을 따라 새 문서를 만들거나, 기존의 문서를 교체한다.

![image](https://user-images.githubusercontent.com/87873821/221027341-09802cb0-94dc-4a49-beb1-db09f9cd3cb3.png)

- ### 3.3.5 **POST**
  - 서버에 입력 데이터를 전송하기 위해 설계.
  - 주로 HTML 폼을 지원하며, 해당 폼에 담긴 데이터는 서버로 전송되어 처리된다.
- ### 3.3.6 **TRACE**
  - 요청 메시지는 방화벽, 프록시, 게이트워이등 어플리케이션을 통과한다. 이때 TRACE 메서드는 클라이언트에 자신이 서버에 도달할 경우 어떻게 보이게 되는지 알려준다.
  - TRACE 메서드는 목적지 서버에서 루프백 진단을 시작하여, 자신과 목적지 서버 사이에 있는 모든 HTTP 어플리케이션의 요청, 응답을 따라가면서 메시지가 어떻게 변경되었는지 확인할 수 있다.
- ### 3.3.7 **OPTIONS**
  - OPTIONS 메서드는 웹 서버에 여러 종류의 지원 범위에 대해 물어본다.
  - 특정 리소스에 대해 어떤 메소드가 지원되는지 물어볼 수 있다.

![image](https://user-images.githubusercontent.com/87873821/221029319-2629ff38-32f0-4da2-9794-48df3e1b28fa.png)

- ### 3.3.8 **DELETE**
  - DELETE 메서드는 서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청한다.
  - 하지만 HTTP 명세는 서버가 클라이언트에게 알리지 않고 요청을 무시하는 것을 허용하기 때문에 삭제가 수행되는 것을 보장하지 못한다.

![image](https://user-images.githubusercontent.com/87873821/221030256-eaf342d2-e716-40e0-8a8f-ee5b4ece6995.png)

- ### 3.3.9 확장 메서드
  - HTTP는 필요에 따라 확장해서 사용할 수 있으므로, 확장 메서드를 추가해서 사용할 수 있다.
## 3.4 상태 코드
- HTTP 상태 코드는 크게 5가지로 나눌 수 있고, 상태 코드를 통해 트랜잭션을 이해할 수 있다.
- ### 3.4.1 100~199 정보성 상태 코드
  - 정보성 상태 코드는 HTTP/1.1 에서 도입되었다.
  
| 상태 코드 | 사유 구절 | 의미 |
| -- | -- | -- |
| 100 | Continue | ... |
| 101 | Switching Protocols | ... | 

- ### 3.4.2 200~299 성공 상태 코드
  - 클라이언트의 요청이 성공시, 서버는 성공을 의미하는 다양한 상태 코드 배열을 가지고 있다.

| 상태 코드 | 사유 구절 | 의미 |
| -- | -- | -- |
| 200 | OK | ... |
| 201 | Created | ... | 
| ... | ... | ... | 

- ### 3.4.3 300~399 리다이렉션 상태 코드
  - 클라이언트가 요청한 리소스에 대해 다른 위치를 말해주거나 다른 대안 응답을 의미한다.

| 상태 코드 | 사유 구절 | 의미 |
| -- | -- | -- |
| 300 | Multiple Choices | ... |
| 301 | Moved Permanentely | ... | 
| ... | ... | ... | 

- ### 3.4.4 400~499 클라이언트 에러 상태 코드
  - 클라이언트는 간혹 서버가 다루지 못할 요청을 전송한다.
  - 클라이언트가 알 수 없는 리소스에 대해 요청을 할 경우, 이러한 상태 코드를 반환한다.
  
| 상태 코드 | 사유 구절 | 의미 |
| -- | -- | -- |
| 400 | Multiple Choices | ... |
| 401 | Moved Permanentely | ... | 
| ... | ... | ... | 

- ### 3.4.5 500~599 서버 에러 상태 코드
  - 클라이언트가 올바른 요청을 보내도 서버 자체에서 에러가 발생할 수 있다.
  - 클라이언트가 서버의 제한에 걸리거나, 게이트웨이와 같은 서버의 보조 구성요소에서 발생한 에러일 수 있다.

| 상태 코드 | 사유 구절 | 의미 |
| -- | -- | -- |
| 500 | Internal Server error | ... |
| 501 | Not Implemented | ... | 
| ... | ... | ... | 

## 3.5 헤더
- 헤더와 메서드는 클라이언트와 서버가 무엇을 하는지 알기 위해 사용된다.
- ### 일반 헤더
  - 클라이언트, 서버 양쪽 다 사용한다.
  - 어딘가에 HTTP 메시지를 보내는 경우 다양한 목적으로 사용되고 있다.

| 헤더 | 설명 |
| -- | -- |
| Connection | 클라이언트와 서버가 요청 / 응답 연결에 대한 옵션을 정할 수 있게 해줌 |
| Date | HTTP 메시지 생성 일자 제공 | 
| ... | ... |
- ### 일반 캐시 헤더
  - HTTP/1.0은 매번 새로운 객체가 아닌 로컬 복사본으로 가져올 수 있는 최초의 헤더를 도입했다.

| 헤더 | 설명 |
| -- | -- |
| Cache-Control | 메시지와 함께 캐시 지시자를 전달하기 위해 사용 |
| Pragma | 메시지와 함께 지시자를 전달하는 또 다른 방법. 캐시에 국한되지 않음 | 
| ... | ... |

- ### 요청 헤더
  - 요청 메시지를 위한 헤더이다.
  - 서버에게 클라이언트가 받고자 하는 데이터의 타입과 같은 부가 정보를 제공한다.

| 헤더 | 설명 |
| -- | -- |
| Client-IP | 클라이언트가 실행된 컴퓨터의 IP 제공 |
| From | 클라이언트 사용자의 메일 주소 제공 | 
| Host | 요청의 대상이 되는 서버의 호스트 명과 포트 제공 | 
| ... | ... |
- ### Accept 관련 헤더
  - 클라이언트는 Accept 관련 헤더들을 이용해 서버에게 자신이 필요한 내용 전달 가능

| 헤더 | 설명 |
| -- | -- |
| Accept | 서버가 보내도 되는 미디어 종류 전달 |
| Accept-Charset | 서버가 보내도 되는 문자집합 전달 | 
| Accept-Encoding | 서버가 보내도 되는 인코딩 전달 | 
| ... | ... |
- ### 조건부 요청 헤더
  - 클라이언트는 요청에 조건을 넣어 특정 조건에서만 서버가 리소스를 전송할 수 있게 요청 가능.
  
| 헤더 | 설명 |
| -- | -- |
| Expect | 클라이언트가 요청에 필요한 서버의 행동을 열거할 수 있게 함 |
| If-Match | 문서의 엔티티 태그가 주어진 엔티티 태그와 일치한 경우에만 문서를 가져옴 | 
| ... | ... |
- ### 요청 보안 헤더
  - HTTP는 자체적으로 요청을 위한 간단한 인증/응답 체계를 갖추고 있다.
  - 리소스에 접근하기 전에 인증을 함으로써 트랜잭션이 좀 더 안전해진다.

| 헤더 | 설명 |
| -- | -- |
| Authorization | 클라이언트가 서버에게 제공하는 인증 그 자체에 대한 정보 포함 |
| Cookie | 클라이언트가 서버에게 토큰을 전달할 때 사용 | 
| ... | ... |
- ### 프락시 요청 헤더
  - 인터넷에서 프록시가 흔해지면서 몇몇 헤더들이 정의됨. 

| 헤더 | 설명 |
| -- | -- |
| Max-Forwards | 요청이 원 서버로 향하는 과정에서 다른 프락시나 게이트웨이로 전달되는 최대 횟수 |
| ... | ... |
- ### 응답 헤더
  - 서버가 클라이언트에게 부가 정보를 제공하는 헤더이다.

| 헤더 | 설명 |
| -- | -- |
| Age | 응답이 얼마나 오래 되었는지 |
| Public | 서버가 특정 리소스에 대해 지원하는 요청 메서드의 목록 |
| ... | ... |
- ### 엔티티 헤더
  - 엔티티 본문에 대한 헤더를 의미한다.
  - Content-Type: text/html; 헤더는 본문이 HTML 문서임을 알려준다.

| 헤더 | 설명 |
| -- | -- |
| Allow | 이 엔티티에 대해 수행될 수 있는 메서드 나열 |
| Location | 클라이언트에게 엔티티가 실제로 어디에  |
| ... | ... |
- ### 콘텐츠 헤더
  - 콘텐츠 헤더는 엔티티의 내용에 대해 구체적인 정보를 제공한다.

| 헤더 | 설명 |
| -- | -- |
| Content-Base | 본문에 사용된 상대 URL을 계산하기 위한 기저 URL |
| Content-Encoding | 본문에 적용된 어떤 인코딩  |
| ... | ... |