# 4. 커넥션 관리
- HTTP 어플리케이션을 개발한다면 HTTP 커넥션과 HTTP 메시지에 대한 흐름을 잘 이해해야 한다.

## 4.1 TCP 커넥션
- 모든 HTTP 통신은 패킷 교환 네트워크 프로토콜들의 계층화된 집합인 TCP/IP 를 통해 이루어진다.
- TCP/IP 커넥션을 맺으면 클라이언트와 서버간 주고받는 메시지들은 손실되지 않으며 안전하게 전달된다.

```
TCP 커넥션 진행 순서

0. 브라우저에 아래 URL 입력
http://hello.com:80/index.html

1. 호스트 명 추출
www.hello.com

2. 호스트 명에 대한 IP 주소 추출
123.45.67.8

3. 포트번호 추출
80

4. 브라우저가 123.45.67.8 의 80번 포트에 TCP 커넥션 생성

브라우저 ---TCP--- 서버

5. 브라우저가 서버에 GET 요청 전달

브라우저 ---GET---> 서버

6. 브라우저가 서버에서 전달한 응답 메시지 확인

브라우저 <---Response--- 서버

7. 브라우저가 커넥션 종료

브라우저 ---X--- 서버
```

- ### **4.1.1 신뢰할 수 있는 데이터 전송 통로인 TCP**
  - HTTP 커넥션은 몇몇 사용 규칙을 제외하고는 TCP 커넥션에 불과하다.
  - TCP 커넥션의 한쪽에 있는 바이트들은 반대쪽으로 순서에 맞게 전달된다.
  ```
  클라이언트 --- ...lmth.xdeni/ TEG ---> 서버
  ``` 
- ### **4.1.2 TCP 스트림은 세그먼트로 나뉘어 IP 패킷을 통해 전송된다.**
  - TCP는 IP 패킷이라는 작은 조각을 통해 데이터를 전송한다.
  - HTTP는 프로토콜 스택에서 최상위 계층이다.

![image](https://user-images.githubusercontent.com/87873821/221582603-8de5687c-cb46-48a8-882e-f5659a72d702.png)
  - HTTP가 메시지를 전송하고자 할 경우 현재 연결되어 있는 TCP 커넥션을 통해서 내용을 순서대로 전달한다.
  - TCP는 세그먼트 라는 단위로 데이터 스트림을 잘게 나누고, 세그먼트를 IP 패킷이라는 봉투에 담아 전달한다.
  - 각 TCP 세그먼트는 하나의 IP에서 다른 IP주소로 패킷에 담겨 전달되며, 다음을 포함한다.
    - IP 패킷 헤더
    - TCP 세그먼트 헤더
    - TCP 데이터 조각
  
- ### **4.1.3 TCP 커넥션 유지하기**
  - 컴퓨터는 항상 TCP 커넥션을 여러개 가지고 있으며, 포트 번호를 통해 여러개의 커넥션을 유지한다.
  ```
  TCP 커넥션 값

  <발신지 IP 주소, 발신지 포트, 수신지 IP 주소, 수신지 포트>
  ```
  - 이 네가지 값을 통해 유일한 커넥션을 생성하며, 서로 다른 TCP 커넥션은 구성요소의 값이 모두 같을 수 없다.

- ### **4.1.4 TCP 소켓 프로그래밍**
  - ..?

## 4.2 TCP의 성능에 대한 고려